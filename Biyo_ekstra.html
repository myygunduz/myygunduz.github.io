<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biyokimya Testi (Full Karışık Sistem)</title>
    <style>
        /* --- TASARIM AYARLARI --- */
        :root {
            --bg-color: #eef2f3;
            --card-bg: #ffffff;
            --primary-color: #0277bd; /* Okyanus Mavisi */
            --accent-color: #00acc1;
            --correct-color: #43a047;
            --wrong-color: #d32f2f;
            --text-color: #263238;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        .container {
            width: 90%;
            max-width: 650px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ÜST BİLGİ ALANI */
        .header {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            text-align: center;
        }

        .header h1 { margin: 0; font-size: 1.4rem; }

        .progress-container {
            width: 100%; height: 8px;
            background-color: rgba(255,255,255,0.3);
            margin-top: 15px; border-radius: 4px;
        }
        .progress-bar {
            height: 100%; background-color: #ffeb3b;
            width: 0%; border-radius: 4px; transition: width 0.3s;
        }
        .status-text { margin-top: 8px; font-size: 0.9rem; }

        /* SORU ALANI */
        .question-area { padding: 30px 25px; min-height: 300px; }

        .question-text {
            font-size: 1.2rem; font-weight: 600;
            margin-bottom: 25px; color: var(--primary-color);
        }

        .options-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

        .option-btn {
            background-color: #f5f5f5; border: 2px solid #e0e0e0;
            padding: 15px; border-radius: 10px;
            cursor: pointer; font-size: 1rem; font-weight: 500;
            color: var(--text-color); transition: all 0.2s;
        }
        .option-btn:hover:not(:disabled) {
            background-color: #e1f5fe; border-color: var(--accent-color);
        }

        /* RENKLENDİRME */
        .option-btn.correct {
            background-color: var(--correct-color) !important; color: white !important; border-color: var(--correct-color) !important;
        }
        .option-btn.wrong {
            background-color: var(--wrong-color) !important; color: white !important; border-color: var(--wrong-color) !important;
        }

        /* SONUÇ EKRANI */
        .result-screen { display: none; padding: 40px; text-align: center; }
        .score-circle {
            width: 120px; height: 120px; background: var(--primary-color);
            color: white; border-radius: 50%; margin: 0 auto 20px;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: bold;
        }
        .mistakes-list {
            text-align: left; margin-top: 20px; max-height: 300px;
            overflow-y: auto; border: 1px solid #eee; padding: 15px;
        }
        .mistake-item {
            background: #ffebee; padding: 10px; margin-bottom: 10px;
            border-radius: 6px; border-left: 5px solid var(--wrong-color);
        }

        /* NAVİGASYON */
        .controls {
            padding: 20px; display: flex; justify-content: space-between;
            border-top: 1px solid #eee; background: #fafafa;
        }
        .nav-btn {
            padding: 10px 20px; border: none; border-radius: 8px;
            cursor: pointer; font-weight: 600; background: var(--primary-color);
            color: white;
        }
        .nav-btn:hover { background: #01579b; }
        .nav-btn:disabled { background: #ccc; cursor: not-allowed; }
        .shuffle-btn { background: #ff9800; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="header" id="header-section">
        <h1>Biyokimya: Vitamin, Mineral ve Enzimler</h1>
        <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="status-text">Soru: <span id="current-q-num">1</span> / <span id="total-q-num">?</span></div>
    </div>

    <div class="question-area" id="quiz-section">
        <div class="question-text" id="question-text">Yükleniyor...</div>
        <div class="options-grid" id="options-container"></div>
    </div>

    <div class="result-screen" id="result-section">
        <div class="score-circle" id="score-display">0/0</div>
        <h2>Test Tamamlandı</h2>
        <p id="feedback-message"></p>
        <div id="mistakes-container" class="mistakes-list"></div>
        <button class="nav-btn shuffle-btn" onclick="shuffleAndRestart()" style="margin-top:20px; width:100%;">Yeniden Başlat</button>
    </div>

    <div class="controls" id="controls-section">
        <button class="nav-btn shuffle-btn" onclick="shuffleAndRestart()">Karıştır</button>
        <div>
            <button class="nav-btn" id="prev-btn" onclick="changeQuestion(-1)">Geri</button>
            <button class="nav-btn" id="next-btn" onclick="changeQuestion(1)">İleri</button>
        </div>
    </div>
</div>

<script>
    // VERİ SETİ (40+ Soru)
    // Şıkların sırası burada ne olursa olsun JS kodu bunları her seferinde karıştıracak.
    const rawQuestions = [
        { id: 1, text: "Rodopsin pigmentinin yapısına katılan ve eksikliğinde 'Gece Körlüğü' görülen vitamin hangisidir?", options: ["A Vitamini", "E Vitamini", "D Vitamini", "C Vitamini"], answer: "A Vitamini" },
        { id: 2, text: "Kalsiyum ve fosforun emilimini artırarak kemik gelişimini sağlayan vitamin hangisidir?", options: ["D Vitamini", "K Vitamini", "A Vitamini", "B12 Vitamini"], answer: "D Vitamini" },
        { id: 3, text: "Hücre zarını serbest radikallerden koruyan güçlü antioksidan vitamin hangisidir?", options: ["E Vitamini", "D Vitamini", "K Vitamini", "B1 Vitamini"], answer: "E Vitamini" },
        { id: 4, text: "Kanın pıhtılaşma faktörlerinin sentezi için karaciğerde gerekli olan vitamin hangisidir?", options: ["K Vitamini", "E Vitamini", "C Vitamini", "B6 Vitamini"], answer: "K Vitamini" },
        { id: 5, text: "Çocuklarda 'Raşitizm', yetişkinlerde 'Osteomalazi' hastalığı hangi eksiklikte görülür?", options: ["D Vitamini", "A Vitamini", "E Vitamini", "K Vitamini"], answer: "D Vitamini" },
        { id: 6, text: "Kollajen sentezi için elzem olan ve eksikliğinde 'Skorbüt' görülen vitamin hangisidir?", options: ["C Vitamini", "B1 Vitamini", "E Vitamini", "D Vitamini"], answer: "C Vitamini" },
        { id: 7, text: "Eksikliğinde 'Beriberi' hastalığı oluşan B grubu vitamini hangisidir?", options: ["B1 Vitamini", "B2 Vitamini", "B3 Vitamini", "B6 Vitamini"], answer: "B1 Vitamini" },
        { id: 8, text: "Eksikliğinde ağız kenarında çatlaklar (Keylozis) görülen vitamin hangisidir?", options: ["B2 Vitamini", "B1 Vitamini", "B12 Vitamini", "C Vitamini"], answer: "B2 Vitamini" },
        { id: 9, text: "Eksikliğinde 'Pellegra' (Dermatit, Demans, Diyare) görülen vitamin hangisidir?", options: ["B3 Vitamini", "B1 Vitamini", "B9 Vitamini", "B5 Vitamini"], answer: "B3 Vitamini" },
        { id: 10, text: "Koenzim A'nın (CoA) yapısına katılan vitamin hangisidir?", options: ["B5 Vitamini", "B3 Vitamini", "B7 Vitamini", "B1 Vitamini"], answer: "B5 Vitamini" },
        { id: 11, text: "Amino asit metabolizmasında (Transaminasyon) rol oynayan vitamin hangisidir?", options: ["B6 Vitamini", "B2 Vitamini", "B1 Vitamini", "K Vitamini"], answer: "B6 Vitamini" },
        { id: 12, text: "Çiğ yumurta akındaki 'Avidin' tarafından emilimi engellenen vitamin hangisidir?", options: ["Biotin (B7)", "Kobalamin (B12)", "Folat (B9)", "Niasin (B3)"], answer: "Biotin (B7)" },
        { id: 13, text: "Gebelikte eksikliği 'Nöral Tüp Defektine' yol açan vitamin hangisidir?", options: ["Folik Asit (B9)", "B12 Vitamini", "B6 Vitamini", "A Vitamini"], answer: "Folik Asit (B9)" },
        { id: 14, text: "Mideden salgılanan İntrinsik Faktör ile emilen ve eksikliğinde 'Pernisiyöz Anemi' görülen vitamin hangisidir?", options: ["B12 Vitamini", "B9 Vitamini", "C Vitamini", "B6 Vitamini"], answer: "B12 Vitamini" },
        { id: 15, text: "Vücutta en bol bulunan mineral hangisidir?", options: ["Kalsiyum (Ca)", "Fosfor (P)", "Magnezyum (Mg)", "Demir (Fe)"], answer: "Kalsiyum (Ca)" },
        { id: 16, text: "Hücre dışı sıvının temel katyonu hangisidir?", options: ["Sodyum (Na)", "Potasyum (K)", "Klor (Cl)", "Kalsiyum (Ca)"], answer: "Sodyum (Na)" },
        { id: 17, text: "Hücre içi sıvının temel katyonu hangisidir?", options: ["Potasyum (K)", "Sodyum (Na)", "Magnezyum (Mg)", "Demir (Fe)"], answer: "Potasyum (K)" },
        { id: 18, text: "DNA, RNA ve ATP'nin yapısında bulunan mineral hangisidir?", options: ["Fosfor (P)", "Kükürt (S)", "Klor (Cl)", "Çinko (Zn)"], answer: "Fosfor (P)" },
        { id: 19, text: "Mide asidinin (HCl) üretiminde görev alan anyon hangisidir?", options: ["Klor (Cl)", "Sodyum (Na)", "Potasyum (K)", "İyot (I)"], answer: "Klor (Cl)" },
        { id: 20, text: "Klorofilin merkez atomu olan ve kas kramplarını önleyen mineral hangisidir?", options: ["Magnezyum (Mg)", "Demir (Fe)", "Bakır (Cu)", "Mangan (Mn)"], answer: "Magnezyum (Mg)" },
        { id: 21, text: "Hemoglobinin yapısında oksijen taşıyan mineral hangisidir?", options: ["Demir (Fe)", "Çinko (Zn)", "Bakır (Cu)", "Magnezyum (Mg)"], answer: "Demir (Fe)" },
        { id: 22, text: "Tiroid hormonlarının (T3, T4) sentezi için zorunlu olan mineral hangisidir?", options: ["İyot (I)", "Selenyum (Se)", "Çinko (Zn)", "Flor (F)"], answer: "İyot (I)" },
        { id: 23, text: "İnsülin etkisini artırarak kan şekeri kontrolüne yardımcı olan mineral hangisidir?", options: ["Krom (Cr)", "Mangan (Mn)", "İyot (I)", "Kobalt (Co)"], answer: "Krom (Cr)" },
        { id: 24, text: "Bağışıklık sistemi ve yara iyileşmesi için kritik olan mineral hangisidir?", options: ["Çinko (Zn)", "Bakır (Cu)", "Demir (Fe)", "Kalsiyum (Ca)"], answer: "Çinko (Zn)" },
        { id: 25, text: "Fazlalığında 'Wilson Hastalığı'na yol açan mineral hangisidir?", options: ["Bakır (Cu)", "Çinko (Zn)", "Mangan (Mn)", "Krom (Cr)"], answer: "Bakır (Cu)" },
        { id: 26, text: "Diş minesini güçlendirerek çürükleri önleyen mineral hangisidir?", options: ["Flor (F)", "Kalsiyum (Ca)", "Fosfor (P)", "Çinko (Zn)"], answer: "Flor (F)" },
        { id: 27, text: "B12 vitamininin merkezinde bulunan atom hangisidir?", options: ["Kobalt (Co)", "Demir (Fe)", "Magnezyum (Mg)", "Nikel (Ni)"], answer: "Kobalt (Co)" },
        { id: 28, text: "ATP enerjisi kullanarak iki molekülü birbirine bağlayan enzim sınıfı hangisidir?", options: ["Ligazlar", "Liyazlar", "Hidrolazlar", "Transferazlar"], answer: "Ligazlar" },
        { id: 29, text: "Su katarak kimyasal bağları kıran enzim sınıfı hangisidir?", options: ["Hidrolazlar", "Oksidoredüktazlar", "İzomerazlar", "Ligazlar"], answer: "Hidrolazlar" },
        { id: 30, text: "Bir molekülü kendi izomerine dönüştüren enzim sınıfı hangisidir?", options: ["İzomerazlar", "Transferazlar", "Liyazlar", "Ligazlar"], answer: "İzomerazlar" },
        { id: 31, text: "Bir molekülden fosfat grubunu başka bir moleküle taşıyan enzim sınıfı hangisidir?", options: ["Transferazlar", "Ligazlar", "Oksidoredüktazlar", "Hidrolazlar"], answer: "Transferazlar" },
        { id: 32, text: "İndirgenme-Yükseltgenme (Redoks) tepkimelerini katalizleyen enzim sınıfı hangisidir?", options: ["Oksidoredüktazlar", "Hidrolazlar", "Liyazlar", "İzomerazlar"], answer: "Oksidoredüktazlar" },
        { id: 33, text: "Su kullanmadan kovalent bağları kırarak çift bağ oluşturan enzim sınıfı hangisidir?", options: ["Liyazlar", "Ligazlar", "Transferazlar", "Hidrolazlar"], answer: "Liyazlar" },
        { id: 34, text: "Enzimlerin protein olmayan yardımcı kısımlarına ne ad verilir?", options: ["Kofaktör", "Apoenzim", "Substrat", "İnhibitör"], answer: "Kofaktör" },
        { id: 35, text: "Sadece hayvansal kaynaklarda bulunan vitamin hangisidir?", options: ["B12 Vitamini", "C Vitamini", "Folik Asit", "K Vitamini"], answer: "B12 Vitamini" },
        { id: 36, text: "Alkolizmde emilimi en çok bozulan vitamin hangisidir?", options: ["B1 Vitamini", "C Vitamini", "D Vitamini", "E Vitamini"], answer: "B1 Vitamini" },
        { id: 37, text: "Glutatyon Peroksidaz enziminin yapısında bulunan antioksidan mineral hangisidir?", options: ["Selenyum (Se)", "Demir (Fe)", "Çinko (Zn)", "Bakır (Cu)"], answer: "Selenyum (Se)" },
        { id: 38, text: "Kan basıncının yükselmesine (hipertansiyon) neden olan mineralin aşırı tüketimi hangisidir?", options: ["Sodyum", "Potasyum", "Magnezyum", "Kalsiyum"], answer: "Sodyum" },
        { id: 39, text: "Enzimin sadece protein kısmına ne ad verilir?", options: ["Apoenzim", "Holoenzim", "Koenzim", "Kofaktör"], answer: "Apoenzim" },
        { id: 40, text: "Hangisi yağda çözünen vitaminlerin ortak özelliğidir?", options: ["Depolanabilirler", "Günlük alınmalıdır", "İdrarla atılırlar", "Koenzim olmazlar"], answer: "Depolanabilirler" }
    ];

    let currentQuestions = [];
    let currentIndex = 0;
    let userAnswers = [];

    // Yardımcı Fonksiyon: Diziyi Karıştır (Fisher-Yates)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    window.onload = shuffleAndRestart;

    function shuffleAndRestart() {
        if(document.getElementById('quiz-section').classList.contains('hidden') || confirm("Test sıfırlanacak. Onaylıyor musunuz?")) {
            
            // 1. Soruları Kopyala
            // (JSON.parse/stringify ile derin kopya yapıyoruz ki orijinal 'options' dizisi bozulmasın)
            currentQuestions = JSON.parse(JSON.stringify(rawQuestions));
            
            // 2. Soruların sırasını karıştır
            shuffleArray(currentQuestions);

            // 3. Her sorunun içindeki ŞIKLARI karıştır
            currentQuestions.forEach(q => {
                shuffleArray(q.options);
            });

            // Değişkenleri sıfırla
            currentIndex = 0;
            userAnswers = new Array(currentQuestions.length).fill(null);

            // Ekranları ayarla
            document.getElementById('result-section').style.display = 'none';
            document.getElementById('quiz-section').classList.remove('hidden');
            document.getElementById('controls-section').classList.remove('hidden');
            document.getElementById('header-section').classList.remove('hidden');

            updateUI();
        }
    }

    function updateUI() {
        const currentQ = currentQuestions[currentIndex];
        const isAnswered = userAnswers[currentIndex] !== null;

        // Progress
        document.getElementById('current-q-num').innerText = currentIndex + 1;
        document.getElementById('total-q-num').innerText = currentQuestions.length;
        const pct = ((currentIndex) / currentQuestions.length) * 100;
        document.getElementById('progress-bar').style.width = `${pct}%`;

        // Soru Metni
        document.getElementById('question-text').innerText = currentQ.text;

        // Şıklar
        const container = document.getElementById('options-container');
        container.innerHTML = '';

        currentQ.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => handleAnswer(opt, btn);

            if (isAnswered) {
                btn.disabled = true;
                const saved = userAnswers[currentIndex];
                // Doğru cevap her zaman yeşil
                if (opt === currentQ.answer) btn.classList.add('correct');
                // Kullanıcının seçimi yanlışsa kırmızı
                if (opt === saved.selected && !saved.isCorrect) btn.classList.add('wrong');
            }
            container.appendChild(btn);
        });

        // Butonlar
        document.getElementById('prev-btn').disabled = (currentIndex === 0);
        const nextBtn = document.getElementById('next-btn');
        if (currentIndex === currentQuestions.length - 1) {
            nextBtn.innerText = "Bitir";
            nextBtn.onclick = finishQuiz;
        } else {
            nextBtn.innerText = "İleri";
            nextBtn.onclick = () => changeQuestion(1);
        }
    }

    function handleAnswer(selected, btn) {
        if (userAnswers[currentIndex] !== null) return;

        const currentQ = currentQuestions[currentIndex];
        const isCorrect = (selected === currentQ.answer);

        userAnswers[currentIndex] = {
            questionId: currentQ.id,
            questionText: currentQ.text,
            selected: selected,
            correct: currentQ.answer,
            isCorrect: isCorrect
        };

        // Anlık geri bildirim
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.disabled = true;
            if (b.innerText === currentQ.answer) b.classList.add('correct');
            if (b === btn && !isCorrect) b.classList.add('wrong');
        });
    }

    function changeQuestion(dir) {
        currentIndex += dir;
        updateUI();
    }

    function finishQuiz() {
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('controls-section').classList.add('hidden');
        document.getElementById('header-section').classList.add('hidden');
        
        const resultDiv = document.getElementById('result-section');
        resultDiv.style.display = 'block';

        const mistakesDiv = document.getElementById('mistakes-container');
        mistakesDiv.innerHTML = '';
        let correctCount = 0;

        userAnswers.forEach((ans, i) => {
            if (ans && ans.isCorrect) {
                correctCount++;
            } else {
                const qText = ans ? ans.questionText : currentQuestions[i].text;
                const correctAns = ans ? ans.correct : currentQuestions[i].answer;
                const userAns = ans ? ans.selected : "Boş";

                const item = document.createElement('div');
                item.className = 'mistake-item';
                item.innerHTML = `<strong>${qText}</strong><br>Sizin Cevabınız: <span style="color:red">${userAns}</span><br>Doğru Cevap: <span style="color:green">${correctAns}</span>`;
                mistakesDiv.appendChild(item);
            }
        });

        if (correctCount === currentQuestions.length) {
            mistakesDiv.innerHTML = "<p style='color:green; font-weight:bold;'>Tebrikler! Hiç yanlışınız yok.</p>";
        }

        document.getElementById('score-display').innerText = `${correctCount}/${currentQuestions.length}`;
        const ratio = correctCount / currentQuestions.length;
        document.getElementById('feedback-message').innerText = 
            ratio >= 0.9 ? "Harika bir sonuç!" : 
            ratio >= 0.7 ? "Gayet başarılı." : 
            "Biraz daha tekrar yapmalısın.";
    }
</script>

</body>
</html>
